pihole.home.rinaldolee.com  {
    reverse_proxy 172.17.0.1:81
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

auth.rinaldolee.com {
    encode gzip

    header {
        Strict-Transport-Security "max-age=63072000"
    }

    reverse_proxy https://authentik-server.apps:9443 {
        transport http {
            tls_insecure_skip_verify
        }
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-For {remote}
        header_up Host {host}
    }
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

selfserv.rinaldolee.com {
    reverse_proxy self-service.apps:80

    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

jellyfin.rinaldolee.com {
    reverse_proxy jellyfin.apps:8096
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

jellyseerr.rinaldolee.com {
    reverse_proxy jellyseerr.apps:5055
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

qbit.rinaldolee.com {
    reverse_proxy qbittorrent.apps:8080
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

radarr.rinaldolee.com {
    route {
        # always forward outpost path to actual outpost
        reverse_proxy /outpost.goauthentik.io/* http://authentik_server.apps:9000

        # forward authentication to outpost
        forward_auth http://authentik_server.apps:9000 {
            uri /outpost.goauthentik.io/auth/caddy

            # capitalization of the headers is important, otherwise they will be empty
            copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version

            # optional, in this config trust all private ranges, should probably be set to the outposts IP
            trusted_proxies private_ranges
        }
    }

    reverse_proxy radarr.apps:7878
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

sonarr.rinaldolee.com {
    reverse_proxy sonarr.apps:8989
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

lidarr.rinaldolee.com {
    reverse_proxy lidarr.apps:8686
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

prowlarr.rinaldolee.com {
    reverse_proxy prowlarr.apps:9696
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

bazarr.rinaldolee.com {
    reverse_proxy bazarr.apps:6767
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

git.rinaldolee.com {
    reverse_proxy forgejo.apps:3000
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

prometheus.rinaldolee.com {
    reverse_proxy prometheus.apps:9090
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

chat.rinaldolee.com {
    reverse_proxy rocketchat.apps:3000
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

pterodactyl.rinaldolee.com {
    reverse_proxy 10.2.6.7
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}

pterodactyl-wing.rinaldolee.com:8080 {
    reverse_proxy 10.2.6.7:8080

    header {
        # CORS
        Access-Control-Allow-Origin "*" {
            defer
        }

        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, PATCH, OPTIONS" {
            defer
        }

        Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Upgrade, Connection, Sec-WebSocket-Key, Sec-WebSocket-Version, Sec-WebSocket-Protocol" {
            defer
        }

        Access-Control-Allow-Credentials "true" {
            defer
        }

        Access-Control-Max-Age "86400" {
            defer
        }

        # WebSocket upgrade headers (not strictly required, but improves compatibility)
        Connection "upgrade"
        Upgrade "websocket"
    }

    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
}
